export const ChainList = () => {
  let chains = [];
  let filteredChains = [];

  const getAppKitSupport = (namespace) => {
    if (namespace.startsWith("eip155:")) return "yes";
    if (namespace.startsWith("solana:")) return "yes";
    if (namespace.startsWith("bip122:")) return "yes";
    if (namespace.startsWith("ton:")) return "yes";
    if (namespace.startsWith("polkadot:")) return "partial";
    return "no";
  };

  const getAppKitLabel = (support) => {
    if (support === "yes") return "AppKit";
    if (support === "partial") return "AppKit (Flutter)";
    return "";
  };

  if (typeof document !== "undefined") {
    fetch(
      "https://explorer-api.walletconnect.com/v3/chains?projectId=8e998cd112127e42dce5e2bf74122539"
    )
      .then((response) => response.json())
      .then((data) => {
        chains = Object.keys(data.chains).map((key) => ({
          name: data.chains[key].name,
          namespace: key,
          appKitSupport: getAppKitSupport(key),
        }));
        filteredChains = [...chains];
        renderChains(filteredChains);

        const searchInput = document.querySelector(".search-bar");
        if (searchInput) {
          searchInput.addEventListener("input", (event) => {
            const query = event.target.value.toLowerCase();
            filteredChains = chains.filter((chain) =>
              chain.name.toLowerCase().includes(query)
            );
            renderChains(filteredChains);
          });
        }
      })
      .catch((error) => console.error(error));
  }

  const renderChains = (chains) => {
    const container = document.querySelector(".chain-card-container");
    if (container) {
      container.innerHTML = "";
      chains.forEach((chain) => {
        const card = document.createElement("button");
        card.className = `
          flex items-center justify-center 
          border border-gray-500 p-2 text-center 
          w-full dark:bg-gray-600 dark:text-white h-20
        `;
        card.style.position = "relative";

        const nameSpan = document.createElement("span");
        nameSpan.innerText = chain.name;
        card.appendChild(nameSpan);

        const label = getAppKitLabel(chain.appKitSupport);
        if (label) {
          const badge = document.createElement("span");
          badge.innerText = label;
          badge.style.cssText = `
            position: absolute;
            bottom: 3px;
            right: 3px;
            font-size: 9px;
            padding: 1px 5px;
            border-radius: 3px;
            background-color: ${chain.appKitSupport === "yes" ? "#008847" : "#b45309"};
            color: white;
            font-weight: 600;
            line-height: 1.2;
          `;
          card.appendChild(badge);
        }

        card.onclick = () => {
          navigator.clipboard.writeText(chain.namespace);
          nameSpan.innerText = "Chain ID copied!";
          setTimeout(() => {
            nameSpan.innerText = chain.name;
          }, 3000);
        };
        container.appendChild(card);
      });
    }
  };

  return (
    <div className="chain-list">
      <input
        type="text"
        className="search-bar"
        placeholder="Search for a chain..."
        style={{
          width: "100%",
          padding: "8px",
          marginBottom: "20px",
          marginTop: "20px",
          boxSizing: "border-box",
        }}
      />
      <div
        className="chain-card-container"
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(200px, 1fr))",
          gap: "8px",
        }}
      ></div>
    </div>
  );
};
