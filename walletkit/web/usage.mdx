---
title: Usage
description: How to use WalletKit to connect wallets with decentralized applications
---

import CloudBanner from "/snippets/cloud-banner.mdx";

# WalletKit Usage Guide

This guide walks you through using WalletKit to integrate Web3 wallets with decentralized applications (dapps).

## Prerequisites

- Completed the [installation](/walletkit/web/installation) steps
- Basic knowledge of JavaScript/TypeScript
- Understanding of Web3 wallet concepts

## Setup Process

### 1. Cloud Configuration

First, create a project on Reown Cloud to get a project ID:

1. Go to [https://cloud.reown.com](https://cloud.reown.com)
2. Create a new project
3. Copy your project ID

<CloudBanner />

### 2. Initialize WalletKit

Create a WalletKit instance with your project ID and app metadata:

```javascript
import { Core } from "@walletconnect/core";
import { WalletKit } from "@reown/walletkit";

// Create a Core instance with your project ID
const core = new Core({
  projectId: process.env.PROJECT_ID, // Your Reown Cloud project ID
});

// Initialize WalletKit with the core instance
const walletKit = await WalletKit.init({
  core,
  metadata: {
    name: "My Wallet App",
    description: "Web3 Wallet Application",
    url: "https://mywalletapp.com",
    icons: ["https://mywalletapp.com/icon.png"], // Optional app icons
  },
});
```

> **Important**: Initialize `walletKit` once globally and reuse the same instance throughout your application. For React apps, initialize it in your root component.

## Understanding Sessions

### What is a Session?

A session is a secure connection between a dapp and a wallet. Sessions are:
- Created when a user approves a connection request from a dapp
- Active until manually disconnected or until they expire (default: 7 days)
- Used to handle requests like transaction signing and message signing

### Managing Sessions

#### Retrieving Active Sessions

```javascript
const activeSessions = walletKit.getActiveSessions();
```

#### Creating Sessions with Namespace Builder

The namespace builder simplifies creating compatible session configurations:

```javascript
// Import required utilities
import { WalletKit, WalletKitTypes } from '@reown/walletkit';
import { buildApprovedNamespaces, getSdkError } from '@walletconnect/utils';

// Handle session proposals
async function onSessionProposal({ id, params }: WalletKitTypes.SessionProposal) {
  try {
    // Build namespaces with supported chains, methods, events, and accounts
    const approvedNamespaces = buildApprovedNamespaces({
      proposal: params,
      supportedNamespaces: {
        eip155: {
          chains: ['eip155:1', 'eip155:137'], // Ethereum, Polygon
          methods: ['eth_sendTransaction', 'personal_sign'],
          events: ['accountsChanged', 'chainChanged'],
          accounts: [
            'eip155:1:0xab16a96d359ec26a11e2c2b3d8f8b8942d5bfcdb',
            'eip155:137:0xab16a96d359ec26a11e2c2b3d8f8b8942d5bfcdb'
          ]
        }
      }
    });

    // Approve the session with the built namespaces
    const session = await walletKit.approveSession({
      id,
      namespaces: approvedNamespaces
    });
    
    // Session is now established
  } catch (error) {
    // Handle errors (e.g., show user notification)
    await walletKit.rejectSession({
      id: proposal.id,
      reason: getSdkError("USER_REJECTED")
    });
  }
}

// Listen for session proposals
walletKit.on('session_proposal', onSessionProposal);

// Connect to a dapp using its URI (typically from a QR code)
await walletKit.pair({ uri: "wc:..." });
```

For wallets supporting multiple blockchain ecosystems:

```javascript
const approvedNamespaces = buildApprovedNamespaces({
  proposal: params,
  supportedNamespaces: {
    eip155: {
      // Ethereum configuration
    },
    cosmos: {
      // Cosmos configuration
    },
    near: {
      // NEAR Protocol configuration
    }
  },
});
```

#### Rejecting Sessions

To reject a session proposal:

```javascript
walletKit.on(
  "session_proposal",
  async (proposal: WalletKitTypes.SessionProposal) => {
    await walletKit.rejectSession({
      id: proposal.id,
      reason: getSdkError("USER_REJECTED_METHODS"),
    });
  }
);
```

## Handling Session Requests

### Responding to Requests

When a dapp sends a request (like signing a transaction), handle it with:

```javascript
walletKit.on(
  "session_request",
  async (event: WalletKitTypes.SessionRequest) => {
    const { topic, params, id } = event;
    const { request } = params;
    
    // Example: Processing a message signing request
    if (request.method === "personal_sign") {
      const messageHex = request.params[0];
      const address = request.params[1];
      
      // Convert hex message to readable text
      const message = hexToUtf8(messageHex);
      
      // Sign message with your wallet implementation
      const signedMessage = await wallet.signMessage(message);
      
      // Send successful response
      const response = { 
        id, 
        result: signedMessage, 
        jsonrpc: "2.0" 
      };
      
      await walletKit.respondSessionRequest({ topic, response });
    }
  }
);
```

### Rejecting Requests

To reject a request (e.g., when user cancels):

```javascript
const response = {
  id,
  jsonrpc: "2.0",
  error: {
    code: 5000,
    message: "User rejected the request",
  },
};

await walletKit.respondSessionRequest({ topic, response });
```

## Managing Existing Sessions

### Updating Sessions

To add new accounts or chains to an existing session:

```javascript
// Adding a new account
const namespaces = session.namespaces;
const accounts = [
  "eip155:1:0xab16a96d359ec26a11e2c2b3d8f8b8942d5bfcdb",
  "eip155:1:0x1234567890123456789012345678901234567890", // New account
];

const updatedNamespaces = {
  ...namespaces,
  eip155: {
    ...namespaces.eip155,
    accounts,
  },
};

await walletKit.updateSession({
  topic: session.topic,
  namespaces: updatedNamespaces,
});
```

### Extending Session Duration

Sessions expire after 7 days by default. Extend a session with:

```javascript
const { acknowledged } = await walletKit.extendSession({ 
  topic: session.topic 
});

// Optional: Wait for dapp to acknowledge
await acknowledged();
```

### Disconnecting Sessions

To terminate a session:

```javascript
await walletKit.disconnectSession({
  topic: session.topic,
  reason: getSdkError("USER_DISCONNECTED"),
});
```

> **Note**: Always subscribe to the `session_delete` event to handle when a dapp disconnects.

## Emitting Events

Notify dapps about wallet state changes:

```javascript
// Example: Notifying when active account changes
await walletKit.emitSessionEvent({
  topic: session.topic,
  event: {
    name: "accountsChanged",
    data: ["0xab16a96D359eC26a11e2C2b3d8f8B8942d5Bfcdb"],
  },
  chainId: "eip155:1",
});

// Example: Notifying when active chain changes
await walletKit.emitSessionEvent({
  topic: session.topic,
  event: {
    name: "chainChanged",
    data: 1,  // Chain ID
  },
  chainId: "eip155:1",
});
```

## Common Errors and Solutions

### Session Proposal Errors

- **"No matching key. proposal id doesn't exist"**: The proposal may have expired (default: 5 minutes) or been already processed.
  - Solution: Use the correct `proposal.id` from the current proposal payload.

- **"Missing or invalid. approve(), namespaces should be an object with data"**: The namespaces object is invalid.
  - Solution: Ensure you're providing a properly formatted namespaces object.

- **"Non conforming namespaces"**: Your namespaces don't match what the dapp requested.
  - Solution: Use the namespace builder utility and ensure you're supporting all required chains/methods.

### Session Request Errors

- **"No matching key. session topic doesn't exist"**: The session may have been disconnected.
  - Solution: Verify the session exists before responding.

- **"Missing or invalid. respond() response"**: Invalid response format.
  - Solution: Use `formatJsonRpcResult` from `@walletconnect/jsonrpc-utils`.

## Supported Methods and Events

WalletKit supports these Ethereum methods by default:

```javascript
methods: [
  "eth_accounts",
  "eth_requestAccounts",
  "eth_sendRawTransaction",
  "eth_sign",
  "eth_signTransaction",
  "eth_signTypedData",
  "eth_signTypedData_v3",
  "eth_signTypedData_v4",
  "eth_sendTransaction",
  "personal_sign",
  "wallet_switchEthereumChain",
  "wallet_addEthereumChain",
  // And more...
]

events: [
  "chainChanged",
  "accountsChanged",
  "message",
  "disconnect",
  "connect",
]
```

## Additional Resources

- [GitHub Demo Wallet App](https://github.com/WalletConnect/web-examples/tree/main/advanced/wallets/react-wallet-v2)
- [Integration Tests](https://github.com/reown-com/reown-walletkit-js/blob/main/packages/walletkit/test/sign.spec.ts)
- [CAIP-25 Standard](https://github.com/ChainAgnostic/CAIPs/blob/master/CAIPs/caip-25.md)
